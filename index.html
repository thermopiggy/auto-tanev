<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Авточасти Онлайн</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; background: #fafafa;
    }

    /* Sticky navbar */
    .navbar {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: #fff;
      border-bottom: 1px solid #eee;
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .navbar a {
      margin: 0 8px;
      text-decoration: none;
      color: #333;
    }
    .navbar.is-scrolled {
      box-shadow: 0 4px 10px rgba(0,0,0,.06);
    }

    /* Каталог */
    #catalog {
      max-width: 1000px;
      margin: 40px auto;
      padding: 0 16px;
    }
    #catalog h2 {
      margin-bottom: 16px;
      font-size: 1.8rem;
      text-align: center;
    }
    #search {
      width: 100%;
      padding: 10px 14px;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
    }

    /* Grid */
    #products.grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 20px;
    }

    /* Карти */
    .card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: transform 0.2s;
    }
    .card:hover { transform: translateY(-3px); }
    .card img {
      width: 100%; height: 180px; object-fit: cover;
    }
    .card .info {
      padding: 14px;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .card .price {
      font-weight: bold;
      color: #007b3e;
      margin-top: auto;
    }
    .card .actions {
      margin-top: 12px;
      display: flex;
      gap: 8px;
    }
    .card button {
      flex: 1;
      padding: 8px 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.2s;
    }
    .card button.add { background: #f0f0f0; }
    .card button.add:hover { background: #ddd; }
    .card button.buy { background: #25D366; color: white; }
    .card button.buy:hover { background: #1da851; }

    /* Фиксиран бутон за количката */
    body > button {
      background: #25D366;
      color: white;
      font-weight: bold;
      border: none;
      padding: 12px 18px;
      border-radius: 50px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
      cursor: pointer;
      transition: background 0.2s;
    }
    body > button:hover { background: #1da851; }
  </style>
</head>
<body>
  <!-- Навбар -->
  <nav class="navbar">
    <div class="logo">Авточасти Онлайн</div>
    <div class="menu">
      <a href="#catalog">Каталог</a>
      <a href="tel:+359988823462">Телефон</a>
    </div>
  </nav>

  <!-- Каталог -->
  <section id="catalog" class="container">
    <h2>Каталог</h2>
    <input id="search" placeholder="Търси по име, OEM, марка, модел…" />
    <div id="products" class="grid"></div>
  </section>

  <script>
    const WHATSAPP_PHONE = "+359988823462"; // смени при нужда
    const $ = (sel) => document.querySelector(sel);
    const productsEl = $("#products");
    const searchEl = $("#search");
    let products = [];
    let cart = {};

    async function loadProducts() {
      const res = await fetch("products.json");
      products = await res.json();
      render(products);
    }

    function card(p) {
      return `
      <article class="card" data-id="${p.id}">
        <img src="${p.image}" alt="${p.name}" loading="lazy"/>
        <div class="info">
          <h3>${p.name}</h3>
          <p><b>OEM:</b> ${p.oem}</p>
          <p><b>Марка:</b> ${p.brand}</p>
          <p><b>Съвместимост:</b> ${p.fits.join(", ")}</p>
          <p class="price">${p.price.toFixed(2)} лв</p>
          <div class="actions">
            <button class="add">Добави</button>
            <button class="buy">Поръчай по WhatsApp</button>
          </div>
        </div>
      </article>`;
    }

    function render(list) {
      productsEl.innerHTML = list.map(card).join("");
      productsEl.querySelectorAll(".add").forEach(btn => {
        btn.onclick = (e) => {
          const id = e.target.closest("article").dataset.id;
          cart[id] = (cart[id] || 0) + 1;
          e.target.textContent = "Добавено ✓";
          setTimeout(() => (e.target.textContent = "Добави"), 800);
        };
      });
      productsEl.querySelectorAll(".buy").forEach(btn => {
        btn.onclick = (e) => {
          const id = e.target.closest("article").dataset.id;
          const p = products.find(x => x.id === id);
          const txt = `Поръчка:
- ${p.name} (${p.oem}) — 1 бр x ${p.price.toFixed(2)} лв
Обща сума: ${(p.price).toFixed(2)} лв

Име:
Телефон:
Адрес:
Бележки:`;
          const url = `https://wa.me/${WHATSAPP_PHONE.replace(/\D/g,"")}?text=${encodeURIComponent(txt)}`;
          window.open(url, "_blank");
        };
      });
    }

    searchEl?.addEventListener("input", () => {
      const q = searchEl.value.trim().toLowerCase();
      const list = products.filter(p =>
        [p.name, p.oem, p.brand, ...(p.fits||[])].join(" ").toLowerCase().includes(q)
      );
      render(list);
    });

    // бутон за количка
    const cartBtn = document.createElement("button");
    cartBtn.textContent = "Поръчай количка по WhatsApp";
    cartBtn.style.position = "fixed";
    cartBtn.style.right = "16px";
    cartBtn.style.bottom = "16px";
    cartBtn.onclick = () => {
      if (!Object.keys(cart).length) return alert("Количката е празна.");
      let lines = ["Поръчка (количка):"];
      let total = 0;
      for (const [id, qty] of Object.entries(cart)) {
        const p = products.find(x => x.id === id);
        const sum = p.price * qty;
        total += sum;
        lines.push(`- ${p.name} (${p.oem}) — ${qty} бр x ${p.price.toFixed(2)} лв = ${sum.toFixed(2)} лв`);
      }
      lines.push(`Обща сума: ${total.toFixed(2)} лв`, "", "Име:", "Телефон:", "Адрес:", "Бележки:");
      const url = `https://wa.me/${WHATSAPP_PHONE.replace(/\D/g,"")}?text=${encodeURIComponent(lines.join("\n"))}`;
      window.open(url, "_blank");
    };
    document.body.appendChild(cartBtn);

    loadProducts();

    // navbar сянка при скрол
    const nav = document.querySelector('.navbar');
    const onScroll = () => nav.classList.toggle('is-scrolled', window.scrollY > 4);
    onScroll(); window.addEventListener('scroll', onScroll, { passive: true });
  </script>
</body>
</html>
